# ccbox - Secure Claude Code Docker Environment
# Auto-generated by ccbox

FROM node:slim AS base

ENV DEBIAN_FRONTEND=noninteractive

# Essential tools
RUN apt-get update && apt-get install -y --no-install-recommends \
    git gnupg ca-certificates openssh-client \
    curl wget jq \
    gawk sed grep findutils diffutils coreutils \
    bash less tree file patch bc \
    ripgrep fd-find \
    procps \
    zip unzip xz-utils bzip2 \
    locales \
    && rm -rf /var/lib/apt/lists/*

# Locale
RUN sed -i '/en_US.UTF-8/s/^# //g' /etc/locale.gen \
    && locale-gen
ENV LANG=en_US.UTF-8
ENV LC_ALL=en_US.UTF-8

# npm optimization
RUN npm config set fund false \
    && npm config set audit false \
    && npm config set update-notifier false

# fd symlink
RUN ln -s $$(which fdfind) /usr/local/bin/fd

# yq
RUN curl -sL https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 -o /usr/local/bin/yq \
    && chmod +x /usr/local/bin/yq

$extra_languages

$optional_tools

# Node.js tools
RUN npm install -g typescript eslint prettier pnpm --force

WORKDIR /home/node/project

FROM base AS claude

RUN npm install -g @anthropic-ai/claude-code

# Entrypoint
COPY entrypoint.sh /usr/local/bin/entrypoint.sh
RUN chmod +x /usr/local/bin/entrypoint.sh

ENV HOME=/home/node
ENV CCBOX_RAM_PERCENT=$ram_percent
ENV CCBOX_CPU_PERCENT=$cpu_percent

USER node
RUN git config --global --add safe.directory '*'

ENTRYPOINT ["/usr/local/bin/entrypoint.sh"]
